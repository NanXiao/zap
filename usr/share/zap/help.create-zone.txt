ZAP and zone creation
=====================

The zap utility allows you to create zones with a given specification
and control the software installed in and the network configuration of
the zone.

The syntax of the subcommand is:

create-zone -z zone_name [-t whole|sparse|alien]
    [-T template] [-I iso_image]
    [-i ip_address] [-x ip_address] [-R ip_network/prefix]
    [-B] [-d extra_dir] [-o overlay] [-O overlay]
    [-S shared_dir] [-U user]

Supplying the zone_name is mandatory; all other arguments are optional.

The -t flag specifies the zone type, which may be whole, sparse, or
alien. For a whole-root zone, the zone has its own copy of all
required file systems. In a sparse-root zone the file systems
containing the operating system - /lib, /platform, /usr, and /sbin -
are inherited read-only from the global zone (or an alternate source -
see the -T flag). An alien-root zone contains file systems derived
from an ISO image of an alternative illumos distribution. The default
is to create a sparse-root zone. If running an LX-enabled variant, the
lx zone type is also available, in which case the -I flag specifies
a tarball containinbg the Linux image.

The -i flag specifies an IP address. If supplied, the zone will be
given this IP address. This flag can be used multiple times to assign
multiple IP addresses.

The -x flag specifies an IP address. If supplied, the zone will be an
exclusive-ip zone, and a vnic will be created for the zone's use.

As shared-ip and exclusive-ip are incompatible, attempting to supply
both the -i and -x flags is an error.

The -R flag specifies a network and prefix, for which this zone will
proxy network traffic. A public-facing address should be specified
with the -x flag. Zones subsequently created with addresses in the
given network range will be connected topologically behind this zone
and will use it to route (NAT) traffic.

The -d flag specifies a directory to be created and mounted inside the
zone. This flag can be used multiple times to create multiple
directories in the zone.

The -o flag specifies an overlay to be installed in the zone. This flag
can be used multiple times to require multiple overlays. The use of
this flag requires that the zone type be specified as whole. The
effect of listing overlays here is that the zone is created from the
global zone and only contains the subset of the packages that are
contained in the given overlays; specifying an overlay that is not
present in the global zone will generate an error.

The -O flag specifies an overlay to be added to the zone. This flag can
be used multiple times to add multiple overlays. The use of this flag
requires that the zone type be specified as whole. Unlike the -o flag
which specifies that the zone contains a subset of the packages in the
global zone, the -O flag adds extra packages, and does not require the
overlays or packages to be present in the global zone.

The -S flag specifies a directory (that must be present in the global
zone) to be shared with the zone. The shared directory will be mounted
at the same location in the zone as it is in the global zone. This
flag may be specified multiple time to share multiple directories.

The -U flag specifies a user account to be shared with the zone. The
account will be created in the zone with the same details as in the
global zone, and the home directory will be shared. In addition, that
user is delegated management of the zone, including the ability to use
zlogin to connect to the zone. Note that this mechanism gives the
delegated user full root access to the zone, and potentially full root
access to the global zone via shared file systems.

The -T flag allows you to use a template to provide the file systems to
a sparse-root zone instead of the default inheritance from the global
zone. Use the zap create-zone-template subcommand to construct such a
template.

The -I flag is required for an alien zone, and specifies the iso image
that will be used to install the zone. In the case of an lx zone, the
-I flag specifies a tarball containing the a Linux file system.

The -B flag boots the zone as a blank system, with no processes (other
than init) running. It's the responsibility of the user to run any
applications as necessary, using zlogin to connect to the zone.
