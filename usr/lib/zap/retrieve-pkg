#!/bin/ksh

ZAPLIBDIR="/usr/lib/zap"

case $1 in
-C)
	DESTROOT="$2"
	CTXARGS="-C ${DESTROOT}"
	shift
	shift
	if [ ! -d "$DESTROOT" ]; then
	    echo "ERROR: alternate root $DESTROOT doesn't exist"
	    exit 1
	fi
	;;
esac

CACHE_DIR=`${ZAPLIBDIR}/zap-cfg ${CTXARGS} cache-dir`
USER_AGENT="zap"/`${ZAPLIBDIR}/pkgversion TRIBzap`

for pkg in $*
do
    ${ZAPLIBDIR}/get-version ${CTXARGS} $pkg | read fpkg frepo
    if [ -n "$frepo" ]; then
	REPO=`${ZAPLIBDIR}/zap-cfg ${CTXARGS} repo-url $frepo`
	echo "Fetching ${REPO}/${fpkg}.zap"
	/usr/bin/curl -A ${USER_AGENT} -f -s -o ${CACHE_DIR}/${fpkg}.zap ${REPO}/${fpkg}.zap
    fi
done
